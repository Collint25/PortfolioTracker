{% extends "base.html" %}

{% block content %}
<div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold">Trade Lots</h1>
    <div class="flex gap-2 items-center">
        <span class="badge badge-lg">{{ total }} lots</span>
        <button
            hx-post="/lots/auto-match"
            hx-target="#lot-list"
            hx-swap="innerHTML"
            class="btn btn-primary btn-sm"
        >
            Run Auto-Match
        </button>
    </div>
</div>

<!-- P/L Summary Cards -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
    <div class="stat bg-base-100 shadow rounded-lg">
        <div class="stat-title">Total P/L</div>
        <div class="stat-value text-lg {% if summary.total_pl >= 0 %}text-success{% else %}text-error{% endif %}">
            ${{ "%.2f"|format(summary.total_pl) }}
        </div>
    </div>
    <div class="stat bg-base-100 shadow rounded-lg">
        <div class="stat-title">Win Rate</div>
        <div class="stat-value text-lg">{{ "%.1f"|format(summary.win_rate) }}%</div>
        <div class="stat-desc">{{ summary.winners }}W / {{ summary.losers }}L</div>
    </div>
    <div class="stat bg-base-100 shadow rounded-lg">
        <div class="stat-title">Closed</div>
        <div class="stat-value text-lg">{{ summary.closed_count }}</div>
    </div>
    <div class="stat bg-base-100 shadow rounded-lg">
        <div class="stat-title">Open</div>
        <div class="stat-value text-lg">{{ summary.open_count }}</div>
    </div>
</div>

<!-- Filters -->
{% from "macros/filter_controls.html" import account_select, symbol_select, simple_select, filter_buttons %}
<div class="card bg-base-100 shadow mb-6">
    <div class="card-body py-4">
        <form
            hx-get="/lots/"
            hx-target="#lot-list"
            hx-swap="innerHTML"
            hx-push-url="true"
            class="flex flex-wrap gap-4 items-end"
        >
            {{ account_select("account_id", accounts, filters.account_id) }}
            {{ symbol_select("symbol", symbols, filters.symbol) }}
            {{ simple_select("instrument_type", "Type", [
                {"value": "STOCK", "label": "Stocks"},
                {"value": "OPTION", "label": "Options"}
            ], filters.instrument_type) }}
            {{ simple_select("is_closed", "Status", [
                {"value": "true", "label": "Closed"},
                {"value": "false", "label": "Open"}
            ], filters.is_closed|string if filters.is_closed is not none else "") }}
            {{ filter_buttons("/lots/") }}
        </form>
    </div>
</div>

<!-- Lot list -->
<div id="lot-list">
    {% include "partials/lot_list.html" %}
</div>
{% endblock %}
