{
  "description": "The PortfolioTracker application employs a Service-Layer Architecture designed to separate the complexity of external data synchronization from user-facing portfolio management. The system operates on a \"Sync-Process-Present\" flow: raw financial data is ingested via the Sync Orchestrator, refined into meaningful strategies (like option spreads) by the Domain Logic Engine, and served to the user through a Web Interface powered by FastAPI and HTMX. This separation ensures that the heavy lifting of API integration and data normalization does not impact the responsiveness of the user interface, while the Portfolio Database acts as the central source of truth for both raw transactions and derived investment insights. The PortfolioTracker is a Hypermedia-Driven Application (HDA) where the server renders HTML directly, leveraging FastAPI for the backend and HTMX for dynamic interactivity. The architecture is centered around a robust Service Layer that isolates business logic from the HTTP transport layer. Data flows from External Providers into the Portfolio Database via the Sync Orchestrator, where it is subsequently refined by the Domain Logic Engine into high-level concepts like \"Linked Trades\" and \"Trade Groups.\" The Web Interface remains thin, primarily orchestrating these services to render views, ensuring a clean separation between data ingestion, domain processing, and user presentation.",
  "components": [
    {
      "name": "Web Interface",
      "description": "The user-facing layer handling HTTP requests, rendering Jinja2 templates, and managing HTMX partial updates. It acts as the controller, delegating logic to services.",
      "referenced_source_code": [
        {
          "qualified_name": "app/routers/sync.py",
          "reference_file": "app/routers/sync.py",
          "reference_start_line": null,
          "reference_end_line": null
        },
        {
          "qualified_name": "app/routers/transactions.py",
          "reference_file": "app/routers/transactions.py",
          "reference_start_line": null,
          "reference_end_line": null
        }
      ],
      "assigned_files": [
        "app/main.py",
        "app/routers/sync.py",
        "app/routers/tags.py",
        "app/routers/trade_groups.py",
        "app/routers/linked_trades.py",
        "app/routers/accounts.py",
        "app/routers/transactions.py",
        "app/routers/__init__.py",
        "app/routers/pages.py",
        "app/routers/comments.py",
        "app/routers/saved_filters.py"
      ],
      "can_expand": false
    },
    {
      "name": "Sync Orchestrator",
      "description": "The core write-service responsible for synchronizing local state with external brokerage accounts. It handles API authentication, data fetching, and normalization.",
      "referenced_source_code": [
        {
          "qualified_name": "app/services/sync_service.py",
          "reference_file": "app/services/sync_service.py",
          "reference_start_line": null,
          "reference_end_line": null
        },
        {
          "qualified_name": "app/services/snaptrade_client.py",
          "reference_file": "app/services/snaptrade_client.py",
          "reference_start_line": null,
          "reference_end_line": null
        }
      ],
      "assigned_files": [
        "app/services/sync_service.py",
        "app/services/snaptrade_client.py"
      ],
      "can_expand": false
    },
    {
      "name": "Domain Logic Engine",
      "description": "Encapsulates complex business logic for organizing raw trades into meaningful portfolios. This includes auto-linking option legs and managing user-defined trade groups.",
      "referenced_source_code": [
        {
          "qualified_name": "app/services/linked_trade_service.py",
          "reference_file": "app/services/linked_trade_service.py",
          "reference_start_line": null,
          "reference_end_line": null
        },
        {
          "qualified_name": "app/services/trade_group_service.py",
          "reference_file": "app/services/trade_group_service.py",
          "reference_start_line": null,
          "reference_end_line": null
        }
      ],
      "assigned_files": [
        "app/services/linked_trade_service.py",
        "app/services/trade_group_service.py",
        "app/services/position_service.py",
        "app/services/account_service.py",
        "app/services/tag_service.py",
        "app/services/comment_service.py",
        "app/services/saved_filter_service.py"
      ],
      "can_expand": false
    },
    {
      "name": "Transaction Manager",
      "description": "A read-optimized service providing filtered, sorted, and paginated transaction data to the UI. It abstracts complex database queries.",
      "referenced_source_code": [
        {
          "qualified_name": "app/services/transaction_service.py",
          "reference_file": "app/services/transaction_service.py",
          "reference_start_line": null,
          "reference_end_line": null
        }
      ],
      "assigned_files": [
        "app/services/transaction_service.py"
      ],
      "can_expand": false
    },
    {
      "name": "Market Data Service",
      "description": "A specialized service for fetching and caching real-time asset prices and historical market data to value positions.",
      "referenced_source_code": [
        {
          "qualified_name": "app/services/market_data_service.py",
          "reference_file": "app/services/market_data_service.py",
          "reference_start_line": null,
          "reference_end_line": null
        }
      ],
      "assigned_files": [
        "app/services/market_data_service.py"
      ],
      "can_expand": false
    },
    {
      "name": "Portfolio Database",
      "description": "The relational data store (SQLite/SQLAlchemy) holding all application state, from raw account data to derived trade groupings.",
      "referenced_source_code": [
        {
          "qualified_name": "app/models/transaction.py",
          "reference_file": "app/models/transaction.py",
          "reference_start_line": null,
          "reference_end_line": null
        },
        {
          "qualified_name": "app/models/linked_trade.py",
          "reference_file": "app/models/linked_trade.py",
          "reference_start_line": null,
          "reference_end_line": null
        }
      ],
      "assigned_files": [
        "app/database.py",
        "app/models/trade_group.py",
        "app/models/linked_trade_leg.py",
        "app/models/linked_trade.py",
        "app/models/comment.py",
        "app/models/transaction.py",
        "app/models/security.py",
        "app/models/__init__.py",
        "app/models/position.py",
        "app/models/base.py",
        "app/models/tag.py",
        "app/models/account.py",
        "alembic/env.py",
        "alembic/versions/b8c4d6e9f0a2_add_linked_trades.py",
        "alembic/versions/c9d5e7f1a3b4_add_previous_close.py",
        "alembic/versions/38ceb7030ea7_initial_schema.py",
        "alembic/versions/1041a34d8090_add_tags_and_comments.py",
        "alembic/versions/1b71213d8c1a_add_trade_groups.py",
        "alembic/versions/a7f3c2d5e8b1_add_option_support.py",
        "app/models/saved_filter.py",
        "alembic/versions/5990bd38093f_add_saved_filters.py"
      ],
      "can_expand": true
    },
    {
      "name": "External Providers",
      "description": "Third-party APIs providing financial data and brokerage connections.",
      "referenced_source_code": [
        {
          "qualified_name": "SnapTrade API",
          "reference_file": "app/services/snaptrade_client.py",
          "reference_start_line": 6,
          "reference_end_line": 12
        }
      ],
      "assigned_files": [],
      "can_expand": false
    },
    {
      "name": "Unclassified",
      "description": "Component for all unclassified files and utility functions (Utility functions/External Libraries/Dependencies)",
      "referenced_source_code": [],
      "assigned_files": [
        "run.py",
        "app/config.py",
        "app/logging_config.py",
        "app/__init__.py",
        "app/services/__init__.py",
        "app/services/base.py",
        "app/services/filters.py",
        "app/services/sync/__init__.py",
        "app/services/sync/snaptrade_parser.py",
        "app/services/sync/position_sync.py",
        "app/services/sync/transaction_sync.py",
        "scripts/backfill_options.py"
      ],
      "can_expand": false
    }
  ],
  "components_relations": [
    {
      "relation": "Triggers synchronization jobs based on user actions.",
      "src_name": "Web Interface",
      "dst_name": "Sync Orchestrator"
    },
    {
      "relation": "Requests filtered transaction history for display.",
      "src_name": "Web Interface",
      "dst_name": "Transaction Manager"
    },
    {
      "relation": "Writes normalized account and transaction data.",
      "src_name": "Sync Orchestrator",
      "dst_name": "Portfolio Database"
    },
    {
      "relation": "Reads raw trades and writes linked trade associations.",
      "src_name": "Domain Logic Engine",
      "dst_name": "Portfolio Database"
    },
    {
      "relation": "Fetches real-time pricing data.",
      "src_name": "Market Data Service",
      "dst_name": "External Providers"
    },
    {
      "relation": "Connects to brokerage APIs for account history.",
      "src_name": "Sync Orchestrator",
      "dst_name": "External Providers"
    },
    {
      "relation": "Executes read-only queries for UI presentation.",
      "src_name": "Transaction Manager",
      "dst_name": "Portfolio Database"
    }
  ]
}